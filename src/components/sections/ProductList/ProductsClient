'use client';
import { useState, useEffect } from "react";
import ProductList from "./ProductList";

export default function ProductsClient() {
  const [products, setProducts] = useState([]);

  useEffect(() => {
    async function fetchProducts() {
      const res = await fetch("/api/products");
      const data = await res.json();
      const searchParams = new URLSearchParams(window.location.search);
      const category = searchParams.get("category") || "all";
      const filtered = category === "all" ? data : data.filter(p => p.category === category);
      setProducts(filtered);
    }
    fetchProducts();
  }, [typeof window !== "undefined" && window.location.search]);

  return <ProductList products={products} />;
}
